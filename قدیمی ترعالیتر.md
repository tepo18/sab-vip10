from ping3 import ping
from colorama import Fore, Style, init
import os
import re

init(autoreset=True)

def is_valid_ping(host):
    try:
        delay = ping(host, timeout=1)
        if delay is not None:
            return True
    except Exception:
        pass
    return False

def extract_host_from_config(config):
    # Simple function to extract host or IP from config line
    match = re.search(r'@([^\s:/]+)', config)
    if match:
        return match.group(1)
    match = re.search(r'://([^:/]+)', config)
    if match:
        return match.group(1)
    return None

def main():
    print(Fore.YELLOW + "Paste your configs (one per line). End with an empty line:" + Style.RESET_ALL)

    configs = []
    while True:
        line = input()
        if line.strip() == '':
            break
        configs.append(line.strip())

    print(Fore.CYAN + f"\nChecking {len(configs)} configs, please wait..." + Style.RESET_ALL)

    filtered = []
    for cfg in configs:
        host = extract_host_from_config(cfg)
        if host:
            if is_valid_ping(host):
                filtered.append(cfg)
                print(Fore.GREEN + f"Valid and responsive: {host}" + Style.RESET_ALL)
            else:
                print(Fore.RED + f"No response or invalid host: {host}" + Style.RESET_ALL)
        else:
            print(Fore.MAGENTA + "Could not extract host from config:" + Style.RESET_ALL, cfg)

    if not filtered:
        print(Fore.RED + "\nNo valid configs found!" + Style.RESET_ALL)
        return

    print(Fore.YELLOW + "\nChoose output option:\n1) Show filtered configs here\n2) Save filtered configs to file inside 'configs/filtered_configs.txt'" + Style.RESET_ALL)
    choice = input(Fore.CYAN + "Enter 1 or 2: " + Style.RESET_ALL)

    if choice == '1':
        print(Fore.GREEN + "\nFiltered configs:\n" + Style.RESET_ALL)
        for f in filtered:
            print(f)
    elif choice == '2':
        if not os.path.exists('configs'):
            os.mkdir('configs')
        with open('configs/filtered_configs.txt', 'w') as f:
            for item in filtered:
                f.write(item + '\n')
        print(Fore.GREEN + "Filtered configs saved to configs/filtered_configs.txt" + Style.RESET_ALL)
    else:
        print(Fore.RED + "Invalid choice!" + Style.RESET_ALL)

    final_choice = input(Fore.YELLOW + "\nDo you want to (1) view the saved file or (2) exit? Enter 1 or 2: " + Style.RESET_ALL)
    if final_choice == '1':
        try:
            with open('configs/filtered_configs.txt', 'r') as f:
                content = f.read()
            print(Fore.GREEN + "\nContent of filtered_configs.txt:\n" + Style.RESET_ALL)
            print(content)
        except Exception as e:
            print(Fore.RED + f"Error reading file: {e}" + Style.RESET_ALL)
    else:
        print(Fore.CYAN + "Exiting..." + Style.RESET_ALL)

if __name__ == "__main__":
    main()
